
% Convention for theorems.
% {Theorem} --- framed theorem
% {theorem} --- non-framed theorem
% {Theorem*} --- framed theorem without numbering
% {theorem*} --- non-framed theorem without numbering

\NewDocumentCommand{\framesetup}{m}{
    \IfNoValueTF{#1}{
        \mdfsetup{innertopmargin=-3pt,linecolor=black,%
              linewidth=1pt,topline=true, frametitleaboveskip=\dimexpr-\ht\strutbox\relax,}
    }{
        \mdfsetup{frametitle={%
            \tikz[baseline=(current bounding box.east),outer sep=0pt]
            \node[anchor=east,rectangle,fill=white]{\strut #1};}}
        \mdfsetup{innertopmargin=-10pt,linecolor=black,%
              linewidth=1pt,topline=true, frametitleaboveskip=\dimexpr-\ht\strutbox\relax,}
    }
}

\NewDocumentCommand{\MakeFramedTheorem}{mm}{
    \NewDocumentEnvironment{#1}{oo}
        {\framesetup{##1}\begin{mdframed}\begin{#2}[##2]}
        {\end{#2}\end{mdframed}}
}

\ExplSyntaxOn
\tl_new:N\l_env_name_tl
\tl_new:N\l_framed_env_name_tl

\NewDocumentCommand{\NewDocumentTheorem}{mmd[]}{
  \exp_args:NNf\tl_set:Nn\l_env_name_tl{\str_lowercase:n{#1}}
  %\tl_set:Nn\l_env_name_tl{#1}
  \tl_set:Nx\l_framed_env_name_tl{\str_uppercase:f{\tl_head:N\l_env_name_tl}\tl_tail:N\l_env_name_tl}
  \exp_args:Nf\newkeytheorem{\tl_use:N\l_env_name_tl}[name=#2, #3]
  \exp_args:Nf\newkeytheorem{\tl_use:N\l_env_name_tl*}[name=#2, numbered=false, #3]
  \exp_args:Nxx\MakeFramedTheorem{\tl_use:N\l_framed_env_name_tl}{\tl_use:N\l_env_name_tl}
  \exp_args:Nxx\MakeFramedTheorem{\tl_use:N\l_framed_env_name_tl*}{\tl_use:N\l_env_name_tl*}
}
\ExplSyntaxOff
